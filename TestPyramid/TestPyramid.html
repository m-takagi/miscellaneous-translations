<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.1//EN" "http://www.w3.org/TR/xhtml11/DTD/xhtml11.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" xmlns:ops="http://www.idpf.org/2007/ops" xml:lang="ja">
<head>
  <meta http-equiv="Content-Type" content="text/html;charset=UTF-8" />
  <meta http-equiv="Content-Style-Type" content="text/css" />
  <link rel="stylesheet" type="text/css" href="style.css" />
  <meta name="generator" content="ReVIEW" />
  <title>テストピラミッド</title>
</head>
<body>
<h1><a id="h"></a>テストピラミッド</h1>
<div class="lead">
<p>Martin Fowler's blikiの&quot;<a href="http://martinfowler.com/bliki/TestPyramid.html" class="link">TestPyramid</a>&quot;の翻訳。</p>
</div>
<p>1 May 2012</p>
<p class="flushright">tags: <a href="http://martinfowler.com/tags/testing.html" class="link">testing</a></p>
<p>テストピラミッドは<a href="http://www.mountaingoatsoftware.com/" class="link">Mike Cohn</a>が考えた概念で、彼の著書<a href="http://www.amazon.com/dp/product/0321579364/" class="link">Succeeding with Agile</a>に説明がある。そのポイントは、低水準のユニットテストのほうが、GUI経由で実行する高水準のエンドツーエンドテストよりもずっと多くないといけないということだ。</p>
<div class="image">
<img src="images/pyramid.png" alt="" />
</div>
<p>これまでの私の経験では、テストを自動化するというのは、そのアプリケーションをユーザーインターフェイス経由で実行するという意味だった。Such tools would often provide the facility to record an interaction with the application and then allow you to play back that interaction, checking that the application returned the same results. Such an approach works well initially. It's easy to record tests, and the tests can be recorded by people with no knowledge of programming.</p>
<p>でも、この手法はあっという間に問題を引き起こし、<a href="http://watirmelon.com/2012/01/31/introducing-the-software-testing-ice-cream-cone/" class="link">「アイスクリームのコーン」</a>みたいな状態になってしまう。Testing through the UI like this is slow, increasing build times. Often it requires installed licences for the test automation software, which means it can only be done on particular machines. Usually these cannot easily be run in a &quot;headless&quot; mode, monitored by scripts to put in a proper deployment pipeline.</p>
<p>いちばん重要なのは、この手のテストが壊れやすくなってしまうということだ。An enhancement to the system can easily end up breaking lots of such tests, which then have to be re-recorded. You can reduce this problem by abandoning record-playback tools, but that makes the tests harder to write. <a href="#fn-fn01">*1</a> Even with good practices on writing them, end-to-end tests are more prone to <a href="http://martinfowler.com/articles/nonDeterminism.html" class="link">non-determinism problems</a>, which can undermine trust in them. In short, tests that run end-to-end through the UI are: brittle, expensive to write, and time consuming to run. So the pyramid argues that you should do much more automated testing through unit tests than you should through traditional GUI based testing.</p>
<p>このピラミッドでは、中間層のテストも提唱している。アプリケーションのサービス層をテストするもので、私はこれを<a href="http://martinfowler.com/bliki/SubcutaneousTest.html" class="link">皮下テスト</a>と呼んでいる。These can provide many of the advantages of end-to-end tests but avoid many of the complexities of dealing with UI frameworks. In web applications this would correspond to testing through an API layer while the top UI part of the pyramid would correspond to tests using something like <a href="http://seleniumhq.org/" class="link">Selenium</a> or Sahi.</p>
<p>テストピラミッドはアジャイル開発におけるテストでの認知度も高まってきた。その主なメッセージは伝わっているが、よりバランスのとれたテストポートフォリオを作るために、もう少し言っておきたい。In particular a common problem is that teams conflate the concepts of end-to-end tests, UI tests, and customer facing tests. These are all orthogonal characteristics. For example a rich javascript UI should have most of its UI behavior tested with javascript unit tests using something like <a href="http://pivotal.github.com/jasmine/" class="link">Jasmine</a>. A complex set of business rules could have tests captured in a customer-facing form, but run just on the relevant module much as unit tests are.</p>
<p>私が常々言っていることがある。高水準のテストというのは、テストでの守りにおける第二ラインになっているということだ。高水準のテストに失敗したということは、単にその機能の実装コードにバグがあるというだけのことではない。それに関するユニットテストが足りないということも意味するのだ。つまり、失敗したエンドツーエンドテストに対応するときには、同時にユニットテストも追加しなければいけない。</p>
<div class="footnote"><p class="footnote">[<a id="fn-fn01">*1</a>] Record-playback tools are almost always a bad idea for any kind of automation, since they resist changeability and obstruct useful abstractions. They are only worth having as a tool to generate fragments of scripts which you can then edit as a proper programming language, in the manner of <a href="http://www.thoughtworks-studios.com/twist-agile-testing" class="link">Twist</a> or <a href="http://www.gnu.org/software/emacs/manual/html_node/emacs/Save-Keyboard-Macro.html" class="link">Emacs</a>.</p></div>
</body>
</html>
